load("C:/Esmaeil/CeliacProject/Data/Meta Data/3_Final MetaData.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/4_Clonal Expansion Analysis/Based on manually defined clone size ranges/αβ/All Clusters Together_Diagnosis by Diagnosis")
library(dplyr)
library(tidyr)
library(ggplot2)
library(scRepertoire)
# Filter by diagnosis if needed
metadata_filtered <- full_metadata %>%
filter(!is.na(clone_size_ab)) %>%
mutate(clone_category = case_when(
clone_size_ab == 1 ~ "Singleton",
clone_size_ab >= 2 & clone_size_ab <= 10 ~ "Size 2-10",
clone_size_ab >= 11 & clone_size_ab <= 50 ~ "Size 11-50",
clone_size_ab >= 51 & clone_size_ab <= 100 ~ "Size 51-100",
clone_size_ab >= 101 ~ "Size 100+",
TRUE ~ NA_character_
)) %>%
filter(!is.na(clone_category))
# Summarize by Diagnosis and clone category
df <- metadata_filtered %>%
group_by(Diagnosis, clone_category) %>%
summarise(n_cells = n(), .groups = "drop") %>%
complete(Diagnosis, clone_category = c("Singleton", "Size 2-10", "Size 11-50", "Size 51-100", "Size 100+"),
fill = list(n_cells = 0)) %>%
group_by(Diagnosis) %>%
mutate(perc = if (sum(n_cells) == 0) 0 else n_cells / sum(n_cells) * 100) %>%
ungroup()
# Order clone categories
df$clone_category <- factor(df$clone_category, levels = rev(c("Singleton", "Size 2-10", "Size 11-50", "Size 51-100", "Size 100+")))
# Colors and theme
clone_colors <- rev(c("#B3B3B3", "#F0CCFF", "#F8766D", "#619CFF", "#F032E6"))
white_theme <- theme_minimal(base_size = 12) +
theme(
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "white", color = NA),
legend.background = element_rect(fill = "white", color = NA),
axis.text.x = element_text(angle = 45, hjust = 1, size = 3),
axis.text.y = element_text(size = 3),
plot.title = element_text(size = 5, face = "bold", hjust = 0.5),
axis.title.x = element_text(size = 6),
axis.title.y = element_text(size = 6),
legend.title = element_text(size = 5),
legend.text = element_text(size = 4),
legend.key.size = unit(4, "mm")
)
p1 <- ggplot(df, aes(x = Diagnosis, y = perc, fill = clone_category)) +
geom_bar(stat = "identity", width = 0.9) +
scale_fill_manual(values = clone_colors) +
labs(
x = "Diagnosis",
y = "Percentage of Cells",
fill = "Clone Size",
title = "αβ Clonal Size Distribution by Diagnosis (Percentage) | All Clusters"
) +
white_theme +
scale_x_discrete(expand = c(0,10)) +
coord_cartesian(clip = "off")
ggsave("All (Percentage).pdf", p1, width = 4, height = 2, dpi = 600, bg = "white", device = cairo_pdf, family = "Arial Unicode MS")
ggsave("All (Percentage).png", p1, width = 4, height = 2, dpi = 600, bg = "white")
p2 <- ggplot(df, aes(x = Diagnosis, y = n_cells, fill = clone_category)) +
geom_bar(stat = "identity", width = 0.9) +
scale_fill_manual(values = clone_colors) +
labs(
x = "Diagnosis",
y = "Number of Cells",
fill = "Clone Size",
title = "αβ Clonal Size Distribution by Diagnosis (Raw Counts) | All Clusters"
) +
white_theme +
scale_x_discrete(expand = c(0,10)) +
coord_cartesian(clip = "off")
ggsave("All (Raw Counts).pdf", p2, width = 4, height = 2, dpi = 600, bg = "white", device = cairo_pdf, family = "Arial Unicode MS")
ggsave("All (Raw Counts).png", p2, width = 4, height = 2, dpi = 600, bg = "white")
load("C:/Esmaeil/CeliacProject/Data/Meta Data/3_Final MetaData.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/4_Clonal Expansion Analysis/Based on manually defined clone size ranges/αβ/Cluster by Cluster_Diagnosis by Diagnosis/ACD")
library(dplyr)
library(tidyr)
library(ggplot2)
full_metadata$cluster <- recode(full_metadata$cluster,
"Tgd INSIG1+" = "Tγδ INSIG1+",
"NK/Tgd" = "NK/Tγδ",
"Act. Tgd" = "Act. Tγδ",
"Tgd CD8+" = "Tγδ CD8+"
)
full_metadata <- full_metadata[full_metadata$Diagnosis == "ACD", ]
target_clusters <- c(
"Homing plasmablast", "Act. plasma IGHA+", "Mature plasma IGHA+",
"Act. plasmablast", "Plasma IGHG+", "Mem B cells",
"B cells BAFFR+", "Macrophages", "pDC", "Mast cells"
)
metadata_filtered <- full_metadata %>%
filter(!cluster %in% target_clusters)
metadata_filtered <- metadata_filtered %>%
mutate(clone_category = case_when(
clone_size_ab == 1 ~ "Singleton",
clone_size_ab >= 2 & clone_size_ab <= 10 ~ "Size 2-10",
clone_size_ab >= 11 & clone_size_ab <= 50 ~ "Size 11-50",
clone_size_ab >= 51 & clone_size_ab <= 100 ~ "Size 51-100",
clone_size_ab >= 101 ~ "Size 100+",
TRUE ~ NA_character_
))
df <- metadata_filtered %>%
filter(!is.na(clone_category)) %>%
group_by(cluster, clone_category) %>%
summarise(n_cells = n(), .groups = "drop") %>%
complete(cluster, clone_category = c("Singleton", "Size 2-10", "Size 11-50", "Size 51-100", "Size 100+"),
fill = list(n_cells = 0)) %>%
group_by(cluster) %>%
mutate(perc = if (sum(n_cells) == 0) 0 else n_cells / sum(n_cells) * 100) %>%
ungroup()
df$clone_category <- factor(df$clone_category, levels = rev(c("Singleton", "Size 2-10", "Size 11-50", "Size 51-100", "Size 100+")))
df$cluster <- factor(df$cluster)
white_theme <- theme_minimal(base_size = 12) +
theme(
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "white", color = NA),
legend.background = element_rect(fill = "white", color = NA),
axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
axis.text.y = element_text(size = 8),
plot.title = element_text(size = 12, face = "bold", hjust = 0.5)
)
clone_colors <- rev(c("#B3B3B3", "#F0CCFF", "#F8766D", "#619CFF", "#F032E6"))
p1 <- ggplot(df, aes(x = cluster, y = perc, fill = clone_category)) +
geom_bar(stat = "identity") +
scale_fill_manual(values = clone_colors) +
labs(
x = "Cluster", y = "Percentage of Cells", fill = "Clone Size",
title = ""
) +
white_theme
ggsave("CloneSize_ab_Percentage.png", p1, width = 10, height = 5, dpi = 1800, bg = "white")
ggsave("CloneSize_ab_Percentage.pdf", p1, width = 10, height = 5, dpi = 1800, bg = "white", device = cairo_pdf, family = "Arial Unicode MS")
p2 <- ggplot(df, aes(x = cluster, y = n_cells, fill = clone_category)) +
geom_bar(stat = "identity") +
scale_fill_manual(values = clone_colors) +
labs(
x = "Cluster", y = "Number of Cells", fill = "Clone Size",
title = ""
) +
white_theme
ggsave("CloneSize_ab_RawCounts.png", p2, width = 10, height = 5, dpi = 1800, bg = "white")
ggsave("CloneSize_ab_RawCounts.pdf", p2, width = 10, height = 5, dpi = 1800, bg = "white", device = cairo_pdf, family = "Arial Unicode MS")
load("C:/Esmaeil/CeliacProject/Data/Meta Data/3_Final MetaData.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/4_Clonal Expansion Analysis/Based on manually defined clone size ranges/αβ/Cluster by Cluster_Diagnosis by Diagnosis/Healthy")
library(dplyr)
library(tidyr)
library(ggplot2)
full_metadata$cluster <- recode(full_metadata$cluster,
"Tgd INSIG1+" = "Tγδ INSIG1+",
"NK/Tgd" = "NK/Tγδ",
"Act. Tgd" = "Act. Tγδ",
"Tgd CD8+" = "Tγδ CD8+"
)
full_metadata <- full_metadata[full_metadata$Diagnosis == "Healthy", ]
target_clusters <- c(
"Homing plasmablast", "Act. plasma IGHA+", "Mature plasma IGHA+",
"Act. plasmablast", "Plasma IGHG+", "Mem B cells",
"B cells BAFFR+", "Macrophages", "pDC", "Mast cells"
)
metadata_filtered <- full_metadata %>%
filter(!cluster %in% target_clusters)
metadata_filtered <- metadata_filtered %>%
mutate(clone_category = case_when(
clone_size_ab == 1 ~ "Singleton",
clone_size_ab >= 2 & clone_size_ab <= 10 ~ "Size 2-10",
clone_size_ab >= 11 & clone_size_ab <= 50 ~ "Size 11-50",
clone_size_ab >= 51 & clone_size_ab <= 100 ~ "Size 51-100",
clone_size_ab >= 101 ~ "Size 100+",
TRUE ~ NA_character_
))
df <- metadata_filtered %>%
filter(!is.na(clone_category)) %>%
group_by(cluster, clone_category) %>%
summarise(n_cells = n(), .groups = "drop") %>%
complete(cluster, clone_category = c("Singleton", "Size 2-10", "Size 11-50", "Size 51-100", "Size 100+"),
fill = list(n_cells = 0)) %>%
group_by(cluster) %>%
mutate(perc = if (sum(n_cells) == 0) 0 else n_cells / sum(n_cells) * 100) %>%
ungroup()
df$clone_category <- factor(df$clone_category, levels = rev(c("Singleton", "Size 2-10", "Size 11-50", "Size 51-100", "Size 100+")))
df$cluster <- factor(df$cluster)
white_theme <- theme_minimal(base_size = 12) +
theme(
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "white", color = NA),
legend.background = element_rect(fill = "white", color = NA),
axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
axis.text.y = element_text(size = 8),
plot.title = element_text(size = 12, face = "bold", hjust = 0.5)
)
clone_colors <- rev(c("#B3B3B3", "#F0CCFF", "#F8766D", "#619CFF", "#F032E6"))
p1 <- ggplot(df, aes(x = cluster, y = perc, fill = clone_category)) +
geom_bar(stat = "identity") +
scale_fill_manual(values = clone_colors) +
labs(
x = "Cluster", y = "Percentage of Cells", fill = "Clone Size",
title = ""
) +
white_theme
ggsave("CloneSize_ab_Percentage.png", p1, width = 10, height = 5, dpi = 1800, bg = "white")
ggsave("CloneSize_ab_Percentage.pdf", p1, width = 10, height = 5, dpi = 1800, bg = "white", device = cairo_pdf, family = "Arial Unicode MS")
p2 <- ggplot(df, aes(x = cluster, y = n_cells, fill = clone_category)) +
geom_bar(stat = "identity") +
scale_fill_manual(values = clone_colors) +
labs(
x = "Cluster", y = "Number of Cells", fill = "Clone Size",
title = ""
) +
white_theme
ggsave("CloneSize_ab_RawCounts.png", p2, width = 10, height = 5, dpi = 1800, bg = "white")
ggsave("CloneSize_ab_RawCounts.pdf", p2, width = 10, height = 5, dpi = 1800, bg = "white", device = cairo_pdf, family = "Arial Unicode MS")
load("C:/Esmaeil/CeliacProject/Data/Meta Data/3_Final MetaData.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/4_Clonal Expansion Analysis/Based on manually defined clone size ranges/αβ/Cluster by Cluster_Diagnosis by Diagnosis/RCD1")
library(dplyr)
library(tidyr)
library(ggplot2)
full_metadata$cluster <- recode(full_metadata$cluster,
"Tgd INSIG1+" = "Tγδ INSIG1+",
"NK/Tgd" = "NK/Tγδ",
"Act. Tgd" = "Act. Tγδ",
"Tgd CD8+" = "Tγδ CD8+"
)
full_metadata <- full_metadata[full_metadata$Diagnosis == "RCD-I", ]
target_clusters <- c(
"Homing plasmablast", "Act. plasma IGHA+", "Mature plasma IGHA+",
"Act. plasmablast", "Plasma IGHG+", "Mem B cells",
"B cells BAFFR+", "Macrophages", "pDC", "Mast cells"
)
metadata_filtered <- full_metadata %>%
filter(!cluster %in% target_clusters)
metadata_filtered <- metadata_filtered %>%
mutate(clone_category = case_when(
clone_size_ab == 1 ~ "Singleton",
clone_size_ab >= 2 & clone_size_ab <= 10 ~ "Size 2-10",
clone_size_ab >= 11 & clone_size_ab <= 50 ~ "Size 11-50",
clone_size_ab >= 51 & clone_size_ab <= 100 ~ "Size 51-100",
clone_size_ab >= 101 ~ "Size 100+",
TRUE ~ NA_character_
))
df <- metadata_filtered %>%
filter(!is.na(clone_category)) %>%
group_by(cluster, clone_category) %>%
summarise(n_cells = n(), .groups = "drop") %>%
complete(cluster, clone_category = c("Singleton", "Size 2-10", "Size 11-50", "Size 51-100", "Size 100+"),
fill = list(n_cells = 0)) %>%
group_by(cluster) %>%
mutate(perc = if (sum(n_cells) == 0) 0 else n_cells / sum(n_cells) * 100) %>%
ungroup()
df$clone_category <- factor(df$clone_category, levels = rev(c("Singleton", "Size 2-10", "Size 11-50", "Size 51-100", "Size 100+")))
df$cluster <- factor(df$cluster)
white_theme <- theme_minimal(base_size = 12) +
theme(
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "white", color = NA),
legend.background = element_rect(fill = "white", color = NA),
axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
axis.text.y = element_text(size = 8),
plot.title = element_text(size = 12, face = "bold", hjust = 0.5)
)
clone_colors <- rev(c("#B3B3B3", "#F0CCFF", "#F8766D", "#619CFF", "#F032E6"))
p1 <- ggplot(df, aes(x = cluster, y = perc, fill = clone_category)) +
geom_bar(stat = "identity") +
scale_fill_manual(values = clone_colors) +
labs(
x = "Cluster", y = "Percentage of Cells", fill = "Clone Size",
title = ""
) +
white_theme
ggsave("CloneSize_ab_Percentage.png", p1, width = 10, height = 5, dpi = 1800, bg = "white")
ggsave("CloneSize_ab_Percentage.pdf", p1, width = 10, height = 5, dpi = 1800, bg = "white", device = cairo_pdf, family = "Arial Unicode MS")
p2 <- ggplot(df, aes(x = cluster, y = n_cells, fill = clone_category)) +
geom_bar(stat = "identity") +
scale_fill_manual(values = clone_colors) +
labs(
x = "Cluster", y = "Number of Cells", fill = "Clone Size",
title = ""
) +
white_theme
ggsave("CloneSize_ab_RawCounts.png", p2, width = 10, height = 5, dpi = 1800, bg = "white")
ggsave("CloneSize_ab_RawCounts.pdf", p2, width = 10, height = 5, dpi = 1800, bg = "white", device = cairo_pdf, family = "Arial Unicode MS")
load("C:/Esmaeil/CeliacProject/Data/Meta Data/3_Final MetaData.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/4_Clonal Expansion Analysis/Based on manually defined clone size ranges/αβ/Cluster by Cluster_Diagnosis by Diagnosis/RCD2")
library(dplyr)
library(tidyr)
library(ggplot2)
full_metadata$cluster <- recode(full_metadata$cluster,
"Tgd INSIG1+" = "Tγδ INSIG1+",
"NK/Tgd" = "NK/Tγδ",
"Act. Tgd" = "Act. Tγδ",
"Tgd CD8+" = "Tγδ CD8+"
)
full_metadata <- full_metadata[full_metadata$Diagnosis == "RCD-II", ]
target_clusters <- c(
"Homing plasmablast", "Act. plasma IGHA+", "Mature plasma IGHA+",
"Act. plasmablast", "Plasma IGHG+", "Mem B cells",
"B cells BAFFR+", "Macrophages", "pDC", "Mast cells"
)
metadata_filtered <- full_metadata %>%
filter(!cluster %in% target_clusters)
metadata_filtered <- metadata_filtered %>%
mutate(clone_category = case_when(
clone_size_ab == 1 ~ "Singleton",
clone_size_ab >= 2 & clone_size_ab <= 10 ~ "Size 2-10",
clone_size_ab >= 11 & clone_size_ab <= 50 ~ "Size 11-50",
clone_size_ab >= 51 & clone_size_ab <= 100 ~ "Size 51-100",
clone_size_ab >= 101 ~ "Size 100+",
TRUE ~ NA_character_
))
df <- metadata_filtered %>%
filter(!is.na(clone_category)) %>%
group_by(cluster, clone_category) %>%
summarise(n_cells = n(), .groups = "drop") %>%
complete(cluster, clone_category = c("Singleton", "Size 2-10", "Size 11-50", "Size 51-100", "Size 100+"),
fill = list(n_cells = 0)) %>%
group_by(cluster) %>%
mutate(perc = if (sum(n_cells) == 0) 0 else n_cells / sum(n_cells) * 100) %>%
ungroup()
df$clone_category <- factor(df$clone_category, levels = rev(c("Singleton", "Size 2-10", "Size 11-50", "Size 51-100", "Size 100+")))
df$cluster <- factor(df$cluster)
white_theme <- theme_minimal(base_size = 12) +
theme(
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "white", color = NA),
legend.background = element_rect(fill = "white", color = NA),
axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
axis.text.y = element_text(size = 8),
plot.title = element_text(size = 12, face = "bold", hjust = 0.5)
)
clone_colors <- rev(c("#B3B3B3", "#F0CCFF", "#F8766D", "#619CFF", "#F032E6"))
p1 <- ggplot(df, aes(x = cluster, y = perc, fill = clone_category)) +
geom_bar(stat = "identity") +
scale_fill_manual(values = clone_colors) +
labs(
x = "Cluster", y = "Percentage of Cells", fill = "Clone Size",
title = ""
) +
white_theme
ggsave("CloneSize_ab_Percentage.png", p1, width = 10, height = 5, dpi = 1800, bg = "white")
ggsave("CloneSize_ab_Percentage.pdf", p1, width = 10, height = 5, dpi = 1800, bg = "white", device = cairo_pdf, family = "Arial Unicode MS")
p2 <- ggplot(df, aes(x = cluster, y = n_cells, fill = clone_category)) +
geom_bar(stat = "identity") +
scale_fill_manual(values = clone_colors) +
labs(
x = "Cluster", y = "Number of Cells", fill = "Clone Size",
title = ""
) +
white_theme
ggsave("CloneSize_ab_RawCounts.png", p2, width = 10, height = 5, dpi = 1800, bg = "white")
ggsave("CloneSize_ab_RawCounts.pdf", p2, width = 10, height = 5, dpi = 1800, bg = "white", device = cairo_pdf, family = "Arial Unicode MS")
