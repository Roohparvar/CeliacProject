heatmap_data <- full_metadata %>%
filter(cluster %in% cluster_order) %>%
group_by(Diagnosis, cluster) %>%
summarise(
percent_TRBV7_2 = mean(TRBV == "TRBV7-2", na.rm = TRUE) * 100,
count_TRBV7_2 = sum(TRBV == "TRBV7-2", na.rm = TRUE),
total_cells = n()
) %>%
ungroup()
heatmap_data$cluster <- factor(heatmap_data$cluster, levels = cluster_order)
p <- ggplot(heatmap_data, aes(x = cluster, y = Diagnosis, fill = percent_TRBV7_2)) +
geom_tile(color = "white") +
geom_text(aes(label = paste0(round(percent_TRBV7_2, 1), "%")), size = 1, color = "black") +
scale_fill_gradient(low = "white", high = "darkred", name = "% TRBV7-2") +
theme_minimal() +
labs(
title = "TRBV7-2 Frequency in CD4+ T Cell Clusters",
x = "Cluster",
y = "Diagnosis"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 3),
axis.text.y = element_text(size = 3),
axis.title.x = element_text(size = 3, face = "bold"),
axis.title.y = element_text(size = 3, face = "bold"),
plot.title = element_text(hjust = 0.5, size = 4, face = "bold"),
# تنظیمات لجند
legend.title = element_text(size = 6, face = "bold"),  # سایز عنوان لجند
legend.text  = element_text(size = 5),                 # سایز متن لجند
legend.key.size = unit(0.4, "cm"),                     # اندازه جعبه‌های رنگ
legend.spacing.y = unit(0.2, "cm"),                    # فاصله عمودی بین آیتم‌ها
legend.spacing.x = unit(0.2, "cm")                     # فاصله افقی (در حالت افقی)
)
ggsave("TRBV7-2_heatmap.png", plot = p, width = 2, height = 1, dpi = 600, bg = "white")
library(dplyr)
library(ggplot2)
cluster_order <- c("Th1 Mem", "Th17", "Th2/Tfh", "Tregs")
heatmap_data <- full_metadata %>%
filter(cluster %in% cluster_order) %>%
group_by(Diagnosis, cluster) %>%
summarise(
percent_TRBV7_2 = mean(TRBV == "TRBV7-2", na.rm = TRUE) * 100,
count_TRBV7_2 = sum(TRBV == "TRBV7-2", na.rm = TRUE),
total_cells = n()
) %>%
ungroup()
heatmap_data$cluster <- factor(heatmap_data$cluster, levels = cluster_order)
p <- ggplot(heatmap_data, aes(x = cluster, y = Diagnosis, fill = percent_TRBV7_2)) +
geom_tile(color = "white") +
geom_text(aes(label = paste0(round(percent_TRBV7_2, 1), "%")), size = 0.5, color = "black") +
scale_fill_gradient(low = "white", high = "darkred", name = "% TRBV7-2") +
theme_minimal() +
labs(
title = "TRBV7-2 Frequency in CD4+ T Cell Clusters",
x = "Cluster",
y = "Diagnosis"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 3),
axis.text.y = element_text(size = 3),
axis.title.x = element_text(size = 3, face = "bold"),
axis.title.y = element_text(size = 3, face = "bold"),
plot.title = element_text(hjust = 0.5, size = 4, face = "bold"),
# تنظیمات لجند
legend.title = element_text(size = 3, face = "bold"),  # سایز عنوان لجند
legend.text  = element_text(size = 3),                 # سایز متن لجند
legend.key.size = unit(0.2, "cm"),                     # اندازه جعبه‌های رنگ
legend.spacing.y = unit(0.2, "cm"),                    # فاصله عمودی بین آیتم‌ها
legend.spacing.x = unit(0.2, "cm")                     # فاصله افقی (در حالت افقی)
)
ggsave("TRBV7-2_heatmap.png", plot = p, width = 2, height = 1, dpi = 600, bg = "white")
library(dplyr)
library(ggplot2)
cluster_order <- c("Th1 Mem", "Th17", "Th2/Tfh", "Tregs")
heatmap_data <- full_metadata %>%
filter(cluster %in% cluster_order) %>%
group_by(Diagnosis, cluster) %>%
summarise(
percent_TRBV7_2 = mean(TRBV == "TRBV7-2", na.rm = TRUE) * 100,
count_TRBV7_2 = sum(TRBV == "TRBV7-2", na.rm = TRUE),
total_cells = n()
) %>%
ungroup()
heatmap_data$cluster <- factor(heatmap_data$cluster, levels = cluster_order)
p <- ggplot(heatmap_data, aes(x = cluster, y = Diagnosis, fill = percent_TRBV7_2)) +
geom_tile(color = "white") +
geom_text(aes(label = paste0(round(percent_TRBV7_2, 1), "%")), size = 0.5, color = "black") +
scale_fill_gradient(low = "white", high = "darkred", name = "% TRBV7-2") +
theme_minimal() +
labs(
title = "TRBV7-2 Frequency in CD4+ T Cell Clusters",
x = "Cluster",
y = "Diagnosis"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 2),
axis.text.y = element_text(size = 2),
axis.title.x = element_text(size = 2, face = "bold"),
axis.title.y = element_text(size = 2, face = "bold"),
plot.title = element_text(hjust = 0.5, size = 2, face = "bold"),
# تنظیمات لجند
legend.title = element_text(size = 3, face = "bold"),  # سایز عنوان لجند
legend.text  = element_text(size = 3),                 # سایز متن لجند
legend.key.size = unit(0.2, "cm"),                     # اندازه جعبه‌های رنگ
legend.spacing.y = unit(0.2, "cm"),                    # فاصله عمودی بین آیتم‌ها
legend.spacing.x = unit(0.2, "cm")                     # فاصله افقی (در حالت افقی)
)
ggsave("TRBV7-2_heatmap.png", plot = p, width = 2, height = 1, dpi = 600, bg = "white")
library(dplyr)
library(ggplot2)
cluster_order <- c("Th1 Mem", "Th17", "Th2/Tfh", "Tregs")
heatmap_data <- full_metadata %>%
filter(cluster %in% cluster_order) %>%
group_by(Diagnosis, cluster) %>%
summarise(
percent_TRBV7_2 = mean(TRBV == "TRBV7-2", na.rm = TRUE) * 100,
count_TRBV7_2 = sum(TRBV == "TRBV7-2", na.rm = TRUE),
total_cells = n()
) %>%
ungroup()
heatmap_data$cluster <- factor(heatmap_data$cluster, levels = cluster_order)
p <- ggplot(heatmap_data, aes(x = cluster, y = Diagnosis, fill = percent_TRBV7_2)) +
geom_tile(color = "white") +
geom_text(aes(label = paste0(round(percent_TRBV7_2, 1), "%")), size = 0.5, color = "black") +
scale_fill_gradient(low = "white", high = "darkred", name = "% TRBV7-2") +
theme_minimal() +
labs(
title = "TRBV7-2 Frequency in CD4+ T Cell Clusters",
x = "Cluster",
y = "Diagnosis"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 2),
axis.text.y = element_text(size = 2),
axis.title.x = element_text(size = 2, face = "bold"),
axis.title.y = element_text(size = 2, face = "bold"),
plot.title = element_text(hjust = 0.5, size = 2, face = "bold"),
# تنظیمات لجند
legend.title = element_text(size = 3, face = "bold"),  # سایز عنوان لجند
legend.text  = element_text(size = 3),                 # سایز متن لجند
legend.key.size = unit(0.2, "cm"),                     # اندازه جعبه‌های رنگ
legend.spacing.y = unit(0.2, "cm"),                    # فاصله عمودی بین آیتم‌ها
legend.spacing.x = unit(0.2, "cm")                     # فاصله افقی (در حالت افقی)
)
ggsave("TRBV7-2_heatmap.png", plot = p, width = 1, height = 1, dpi = 600, bg = "white")
library(dplyr)
library(ggplot2)
cluster_order <- c("Th1 Mem", "Th17", "Th2/Tfh", "Tregs")
heatmap_data <- full_metadata %>%
filter(cluster %in% cluster_order) %>%
group_by(Diagnosis, cluster) %>%
summarise(
percent_TRBV7_2 = mean(TRBV == "TRBV7-2", na.rm = TRUE) * 100,
count_TRBV7_2 = sum(TRBV == "TRBV7-2", na.rm = TRUE),
total_cells = n()
) %>%
ungroup()
heatmap_data$cluster <- factor(heatmap_data$cluster, levels = cluster_order)
p <- ggplot(heatmap_data, aes(x = cluster, y = Diagnosis, fill = percent_TRBV7_2)) +
geom_tile(color = "white") +
geom_text(aes(label = paste0(round(percent_TRBV7_2, 1), "%")), size = 0.5, color = "black") +
scale_fill_gradient(low = "white", high = "darkred", name = "% TRBV7-2") +
theme_minimal() +
labs(
title = "TRBV7-2 Frequency in CD4+ T Cell Clusters",
x = "Cluster",
y = "Diagnosis"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 2),
axis.text.y = element_text(size = 2),
axis.title.x = element_text(size = 2, face = "bold"),
axis.title.y = element_text(size = 2, face = "bold"),
plot.title = element_text(hjust = 0.5, size = 2, face = "bold"),
# تنظیمات لجند
legend.title = element_text(size = 3, face = "bold"),  # سایز عنوان لجند
legend.text  = element_text(size = 3),                 # سایز متن لجند
legend.key.size = unit(0.2, "cm"),                     # اندازه جعبه‌های رنگ
legend.spacing.y = unit(0.2, "cm"),                    # فاصله عمودی بین آیتم‌ها
legend.spacing.x = unit(0.2, "cm")                     # فاصله افقی (در حالت افقی)
)
ggsave("TRBV7-2_heatmap.png", plot = p, width = 1.5, height = 1, dpi = 600, bg = "white")
library(dplyr)
library(ggplot2)
cluster_order <- c("Th1 Mem", "Th17", "Th2/Tfh", "Tregs")
heatmap_data <- full_metadata %>%
filter(cluster %in% cluster_order) %>%
group_by(Diagnosis, cluster) %>%
summarise(
percent_TRBV7_2 = mean(TRBV == "TRBV7-2", na.rm = TRUE) * 100,
count_TRBV7_2 = sum(TRBV == "TRBV7-2", na.rm = TRUE),
total_cells = n()
) %>%
ungroup()
heatmap_data$cluster <- factor(heatmap_data$cluster, levels = cluster_order)
p <- ggplot(heatmap_data, aes(x = cluster, y = Diagnosis, fill = percent_TRBV7_2)) +
geom_tile(color = "white") +
geom_text(aes(label = paste0(round(percent_TRBV7_2, 1), "%")), size = 0.5, color = "black") +
scale_fill_gradient(low = "white", high = "darkred", name = "% TRBV7-2") +
theme_minimal() +
labs(
title = "TRBV7-2 Frequency in CD4+ T Cell Clusters",
x = "Cluster",
y = "Diagnosis"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 1),
axis.text.y = element_text(size = 1),
axis.title.x = element_text(size = 2, face = "bold"),
axis.title.y = element_text(size = 2, face = "bold"),
plot.title = element_text(hjust = 0.5, size = 3, face = "bold"),
# تنظیمات لجند
legend.title = element_text(size = 2, face = "bold"),  # سایز عنوان لجند
legend.text  = element_text(size = 2),                 # سایز متن لجند
legend.key.size = unit(0.2, "cm"),                     # اندازه جعبه‌های رنگ
legend.spacing.y = unit(0.2, "cm"),                    # فاصله عمودی بین آیتم‌ها
legend.spacing.x = unit(0.2, "cm")                     # فاصله افقی (در حالت افقی)
)
ggsave("TRBV7-2_heatmap.png", plot = p, width = 1.5, height = 1, dpi = 600, bg = "white")
library(dplyr)
library(ggplot2)
cluster_order <- c("Th1 Mem", "Th17", "Th2/Tfh", "Tregs")
heatmap_data <- full_metadata %>%
filter(cluster %in% cluster_order) %>%
group_by(Diagnosis, cluster) %>%
summarise(
percent_TRBV7_2 = mean(TRBV == "TRBV7-2", na.rm = TRUE) * 100,
count_TRBV7_2 = sum(TRBV == "TRBV7-2", na.rm = TRUE),
total_cells = n()
) %>%
ungroup()
heatmap_data$cluster <- factor(heatmap_data$cluster, levels = cluster_order)
p <- ggplot(heatmap_data, aes(x = cluster, y = Diagnosis, fill = percent_TRBV7_2)) +
geom_tile(color = "white") +
geom_text(aes(label = paste0(round(percent_TRBV7_2, 1), "%")), size = 0.5, color = "black", face = "bold") +
scale_fill_gradient(low = "white", high = "darkred", name = "% TRBV7-2") +
theme_minimal() +
labs(
title = "TRBV7-2 Frequency in CD4+ T Cell Clusters",
x = "Cluster",
y = "Diagnosis"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 1),
axis.text.y = element_text(size = 1),
axis.title.x = element_text(size = 2, face = "bold"),
axis.title.y = element_text(size = 2, face = "bold"),
plot.title = element_text(hjust = 0.5, size = 3, face = "bold"),
# تنظیمات لجند
legend.title = element_text(size = 2, face = "bold"),  # سایز عنوان لجند
legend.text  = element_text(size = 2),                 # سایز متن لجند
legend.key.size = unit(0.2, "cm"),                     # اندازه جعبه‌های رنگ
legend.spacing.y = unit(0.2, "cm"),                    # فاصله عمودی بین آیتم‌ها
legend.spacing.x = unit(0.2, "cm")                     # فاصله افقی (در حالت افقی)
)
ggsave("TRBV7-2_heatmap.png", plot = p, width = 1.5, height = 1, dpi = 600, bg = "white")
library(dplyr)
library(ggplot2)
cluster_order <- c("Th1 Mem", "Th17", "Th2/Tfh", "Tregs")
heatmap_data <- full_metadata %>%
filter(cluster %in% cluster_order) %>%
group_by(Diagnosis, cluster) %>%
summarise(
percent_TRBV7_2 = mean(TRBV == "TRBV7-2", na.rm = TRUE) * 100,
count_TRBV7_2 = sum(TRBV == "TRBV7-2", na.rm = TRUE),
total_cells = n()
) %>%
ungroup()
heatmap_data$cluster <- factor(heatmap_data$cluster, levels = cluster_order)
p <- ggplot(heatmap_data, aes(x = cluster, y = Diagnosis, fill = percent_TRBV7_2)) +
geom_tile(color = "white") +
geom_text(aes(label = paste0(round(percent_TRBV7_2, 1), "%")), size = 0.5, color = "black", fontface = "bold") +
scale_fill_gradient(low = "white", high = "darkred", name = "% TRBV7-2") +
theme_minimal() +
labs(
title = "TRBV7-2 Frequency in CD4+ T Cell Clusters",
x = "Cluster",
y = "Diagnosis"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 1),
axis.text.y = element_text(size = 1),
axis.title.x = element_text(size = 2, face = "bold"),
axis.title.y = element_text(size = 2, face = "bold"),
plot.title = element_text(hjust = 0.5, size = 3, face = "bold"),
# تنظیمات لجند
legend.title = element_text(size = 2, face = "bold"),  # سایز عنوان لجند
legend.text  = element_text(size = 2),                 # سایز متن لجند
legend.key.size = unit(0.2, "cm"),                     # اندازه جعبه‌های رنگ
legend.spacing.y = unit(0.2, "cm"),                    # فاصله عمودی بین آیتم‌ها
legend.spacing.x = unit(0.2, "cm")                     # فاصله افقی (در حالت افقی)
)
ggsave("TRBV7-2_heatmap.png", plot = p, width = 1.5, height = 1, dpi = 600, bg = "white")
library(dplyr)
library(ggplot2)
cluster_order <- c("Th1 Mem", "Th17", "Th2/Tfh", "Tregs")
heatmap_data <- full_metadata %>%
filter(cluster %in% cluster_order) %>%
group_by(Diagnosis, cluster) %>%
summarise(
percent_TRBV7_2 = mean(TRBV == "TRBV7-2", na.rm = TRUE) * 100,
count_TRBV7_2 = sum(TRBV == "TRBV7-2", na.rm = TRUE),
total_cells = n()
) %>%
ungroup()
heatmap_data$cluster <- factor(heatmap_data$cluster, levels = cluster_order)
p <- ggplot(heatmap_data, aes(x = cluster, y = Diagnosis, fill = percent_TRBV7_2)) +
geom_tile(color = "white") +
geom_text(aes(label = paste0(round(percent_TRBV7_2, 1), "%")), size = 0.5, color = "black", fontface = "bold") +
scale_fill_gradient(low = "white", high = "darkred", name = "% TRBV7-2") +
theme_minimal() +
labs(
title = "TRBV7-2 Frequency in CD4+ T Cell Clusters",
x = "Cluster",
y = "Diagnosis"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 1),
axis.text.y = element_text(size = 1),
axis.title.x = element_text(size = 2, face = "bold"),
axis.title.y = element_text(size = 2, face = "bold"),
plot.title = element_text(hjust = 0.5, size = 3, face = "bold"),
# تنظیمات لجند
legend.title = element_text(size = 2, face = "bold"),  # سایز عنوان لجند
legend.text  = element_text(size = 2),                 # سایز متن لجند
legend.key.size = unit(0.2, "cm"),                     # اندازه جعبه‌های رنگ
legend.spacing.y = unit(0.2, "cm"),                    # فاصله عمودی بین آیتم‌ها
legend.spacing.x = unit(0.2, "cm")                     # فاصله افقی (در حالت افقی)
)
ggsave("TRBV7-2_heatmap.png", plot = p, width = 1.3, height = 1, dpi = 600, bg = "white")
library(dplyr)
library(ggplot2)
cluster_order <- c("Th1 Mem", "Th17", "Th2/Tfh", "Tregs")
heatmap_data <- full_metadata %>%
filter(cluster %in% cluster_order) %>%
group_by(Diagnosis, cluster) %>%
summarise(
percent_TRBV7_2 = mean(TRBV == "TRBV7-2", na.rm = TRUE) * 100,
count_TRBV7_2 = sum(TRBV == "TRBV7-2", na.rm = TRUE),
total_cells = n()
) %>%
ungroup()
heatmap_data$cluster <- factor(heatmap_data$cluster, levels = cluster_order)
p <- ggplot(heatmap_data, aes(x = cluster, y = Diagnosis, fill = percent_TRBV7_2)) +
geom_tile(color = "white") +
geom_text(aes(label = paste0(round(percent_TRBV7_2, 1), "%")), size = 0.5, color = "black", fontface = "bold") +
scale_fill_gradient(low = "white", high = "darkred", name = "% TRBV7-2") +
theme_minimal() +
labs(
title = "TRBV7-2 Frequency in CD4+ T Cell Clusters",
x = "Cluster",
y = "Diagnosis"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 1),
axis.text.y = element_text(size = 1),
axis.title.x = element_text(size = 2, face = "bold"),
axis.title.y = element_text(size = 2, face = "bold"),
plot.title = element_text(hjust = 0.5, size = 3, face = "bold"),
# تنظیمات لجند
legend.title = element_text(size = 2, face = "bold"),  # سایز عنوان لجند
legend.text  = element_text(size = 2),                 # سایز متن لجند
legend.key.size = unit(0.2, "cm"),                     # اندازه جعبه‌های رنگ
legend.spacing.y = unit(0.2, "cm"),                    # فاصله عمودی بین آیتم‌ها
legend.spacing.x = unit(0.2, "cm")                     # فاصله افقی (در حالت افقی)
)
ggsave("TRBV7-2_heatmap.png", plot = p, width = 1.3, height = 0.8, dpi = 600, bg = "white")
library(dplyr)
library(ggplot2)
cluster_order <- c("Th1 Mem", "Th17", "Th2/Tfh", "Tregs")
heatmap_data <- full_metadata %>%
filter(cluster %in% cluster_order) %>%
group_by(Diagnosis, cluster) %>%
summarise(
percent_TRBV7_2 = mean(TRBV == "TRBV7-2", na.rm = TRUE) * 100,
count_TRBV7_2 = sum(TRBV == "TRBV7-2", na.rm = TRUE),
total_cells = n()
) %>%
ungroup()
heatmap_data$cluster <- factor(heatmap_data$cluster, levels = cluster_order)
p <- ggplot(heatmap_data, aes(x = cluster, y = Diagnosis, fill = percent_TRBV7_2)) +
geom_tile(color = "white") +
geom_text(aes(label = paste0(round(percent_TRBV7_2, 1), "%")), size = 0.5, color = "black", fontface = "bold") +
scale_fill_gradient(low = "white", high = "darkred", name = "% TRBV7-2") +
theme_minimal() +
labs(
title = "TRBV7-2 Frequency in CD4+ T Cell Clusters",
x = "Cluster",
y = "Diagnosis"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 1.5),
axis.text.y = element_text(size = 1.5),
axis.title.x = element_text(size = 2, face = "bold"),
axis.title.y = element_text(size = 2, face = "bold"),
plot.title = element_text(hjust = 0.5, size = 3, face = "bold"),
# تنظیمات لجند
legend.title = element_text(size = 2, face = "bold"),  # سایز عنوان لجند
legend.text  = element_text(size = 2),                 # سایز متن لجند
legend.key.size = unit(0.2, "cm"),                     # اندازه جعبه‌های رنگ
legend.spacing.y = unit(0.2, "cm"),                    # فاصله عمودی بین آیتم‌ها
legend.spacing.x = unit(0.2, "cm")                     # فاصله افقی (در حالت افقی)
)
ggsave("TRBV7-2_heatmap.png", plot = p, width = 1.3, height = 0.8, dpi = 600, bg = "white")
library(dplyr)
library(ggplot2)
cluster_order <- c("Th1 Mem", "Th17", "Th2/Tfh", "Tregs")
heatmap_data <- full_metadata %>%
filter(cluster %in% cluster_order) %>%
group_by(Diagnosis, cluster) %>%
summarise(
percent_TRBV7_2 = mean(TRBV == "TRBV7-2", na.rm = TRUE) * 100,
count_TRBV7_2 = sum(TRBV == "TRBV7-2", na.rm = TRUE),
total_cells = n()
) %>%
ungroup()
heatmap_data$cluster <- factor(heatmap_data$cluster, levels = cluster_order)
p <- ggplot(heatmap_data, aes(x = cluster, y = Diagnosis, fill = percent_TRBV7_2)) +
geom_tile(color = "white") +
geom_text(aes(label = paste0(round(percent_TRBV7_2, 1), "%")), size = 0.5, color = "black", fontface = "bold") +
scale_fill_gradient(low = "white", high = "darkred", name = "% TRBV7-2") +
theme_minimal() +
labs(
title = "TRBV7-2 Frequency in CD4+ T Cell Clusters",
x = "Cluster",
y = "Diagnosis"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 1.5),
axis.text.y = element_text(size = 1.5),
axis.title.x = element_text(size = 2, face = "bold"),
axis.title.y = element_text(size = 2, face = "bold"),
plot.title = element_text(hjust = 0.5, size = 3, face = "bold"),
# تنظیمات لجند
legend.title = element_text(size = 2, face = "bold"),  # سایز عنوان لجند
legend.text  = element_text(size = 2),                 # سایز متن لجند
legend.key.size = unit(0.15, "cm"),                     # اندازه جعبه‌های رنگ
legend.spacing.y = unit(0.15, "cm"),                    # فاصله عمودی بین آیتم‌ها
legend.spacing.x = unit(0.15, "cm")                     # فاصله افقی (در حالت افقی)
)
ggsave("TRBV7-2_heatmap.png", plot = p, width = 1.3, height = 0.8, dpi = 600, bg = "white")
library(dplyr)
library(ggplot2)
cluster_order <- c("Th1 Mem", "Th17", "Th2/Tfh", "Tregs")
heatmap_data <- full_metadata %>%
filter(cluster %in% cluster_order) %>%
group_by(Diagnosis, cluster) %>%
summarise(
percent_TRBV7_2 = mean(TRBV == "TRBV7-2", na.rm = TRUE) * 100,
count_TRBV7_2 = sum(TRBV == "TRBV7-2", na.rm = TRUE),
total_cells = n()
) %>%
ungroup()
heatmap_data$cluster <- factor(heatmap_data$cluster, levels = cluster_order)
p <- ggplot(heatmap_data, aes(x = cluster, y = Diagnosis, fill = percent_TRBV7_2)) +
geom_tile(color = "white") +
geom_text(aes(label = paste0(round(percent_TRBV7_2, 1), "%")), size = 0.5, color = "black", fontface = "bold") +
scale_fill_gradient(low = "white", high = "darkred", name = "% TRBV7-2") +
theme_minimal() +
labs(
title = "TRBV7-2 Frequency in CD4+ T Cell Clusters",
x = "Cluster",
y = "Diagnosis"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 1.5),
axis.text.y = element_text(size = 1.5),
axis.title.x = element_text(size = 2, face = "bold"),
axis.title.y = element_text(size = 2, face = "bold"),
plot.title = element_text(hjust = 0.5, size = 3, face = "bold"),
# تنظیمات لجند
legend.title = element_text(size = 2, face = "bold"),  # سایز عنوان لجند
legend.text  = element_text(size = 2),                 # سایز متن لجند
legend.key.size = unit(0.15, "cm"),                     # اندازه جعبه‌های رنگ
legend.spacing.y = unit(0.15, "cm"),                    # فاصله عمودی بین آیتم‌ها
legend.spacing.x = unit(0.15, "cm")                     # فاصله افقی (در حالت افقی)
)
ggsave("TRBV7-2_heatmap.png", plot = p, width = 1.3, height = 0.8, dpi = 800, bg = "white")
library(dplyr)
library(ggplot2)
# کلاسترهای مورد نظر
cluster_order <- c("Th1 Mem", "Th17", "Th2/Tfh", "Tregs")
# محاسبه درصد بیان TRBV7-2
heatmap_data <- full_metadata %>%
filter(cluster %in% cluster_order) %>%
group_by(Diagnosis, cluster) %>%
summarise(
percent_TRBV7_2 = mean(TRBV == "TRBV7-2", na.rm = TRUE) * 100,
count_TRBV7_2 = sum(TRBV == "TRBV7-2", na.rm = TRUE),
total_cells = n()
) %>%
ungroup()
# ترتیب صحیح فاکتورها
heatmap_data$cluster <- factor(heatmap_data$cluster, levels = cluster_order)
# رسم Heatmap
# رسم Heatmap با عنوان وسط‌چین
p <- ggplot(heatmap_data, aes(x = cluster, y = Diagnosis, fill = percent_TRBV7_2)) +
geom_tile(color = "white") +
geom_text(aes(label = paste0(round(percent_TRBV7_2, 1), "%")), size = 3, color = "black") +
scale_fill_gradient(low = "white", high = "darkred", name = "% TRBV7-2") +
theme_minimal() +
labs(
title = "TRBV7-2 Frequency in CD4+ T Cell Clusters",
x = "Cluster",
y = "Diagnosis"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5)  # این خط باعث وسط چین شدن عنوان میشه
)
# ذخیره به PNG
ggsave("TRBV7-2_heatmap.png", plot = p, width = 7, height = 5, dpi = 300, bg = "white")
