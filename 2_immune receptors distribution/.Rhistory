load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
unique(full_metadata$Patient)
unique(full_metadata$PatientName)
unique(full_metadata$Diagnosis)
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_jerome.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/1_Data Cleaning/immune receptors distribution Before Data Cleaning")
#--------------------------------------------------------------------------------- Add UMAP plot colored by imm_receptor with custom colors
library(ggplot2)
library(dplyr)
library(cowplot)
# Define receptor colors and labels
receptor_colors <- c(
"ab" = "#ee1819",
"gd" = "#fd7d00",
"abgd" = "#92509f",
"T and B" = "#9b592d",
"hkl" = "#fcd919",
"Aberant ab" = "#3a78ce",
"Aberrant g" = "#47ad45",
"None" = "#eeeeee"
)
receptor_labels <- c(
"ab" = "TCR⍺β",
"gd" = "TRRγδ",
"abgd" = "⍺βγδ",
"T and B" = "T and B",
"hkl" = "hkl",
"Aberant ab" = "Aberrant ⍺β",
"Aberrant g" = "Aberrant γ"
)
# Factor levels
full_metadata$imm_receptor <- factor(
full_metadata$imm_receptor,
levels = c("ab", "gd", "Aberant ab", "Aberrant g", "hkl", "abgd", "T and B", "None")
)
# Plot without legend
main_plot <- ggplot() +
geom_point(
data = full_metadata %>% filter(imm_receptor != ""),
aes(x = scVI_with_hvg_UMAP_1, y = scVI_with_hvg_UMAP_2, color = imm_receptor),
size = 0.2, alpha = 0.8
) +
scale_color_manual(values = receptor_colors, labels = receptor_labels) +
labs(
title = "Distributions of Cells Colored by Immune Receptor",
x = "UMAP 1",
y = "UMAP 2"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5),
legend.position = "none",
panel.grid = element_blank(),
plot.background = element_rect(fill = "white", color = NA)
)
# Extract legend with custom title
legend_plot <- ggplot() +
geom_point(
data = full_metadata %>% filter(imm_receptor != ""),
aes(x = scVI_with_hvg_UMAP_1, y = scVI_with_hvg_UMAP_2, color = imm_receptor)
) +
scale_color_manual(values = receptor_colors, labels = receptor_labels) +
labs(color = "immune receptor") +
guides(color = guide_legend(override.aes = list(size = 4))) +
theme_void()
legend <- cowplot::get_legend(legend_plot)
# Combine plot + legend (UMAP = 8in wide, legend = 2in)
final_plot <- cowplot::plot_grid(main_plot, legend, ncol = 2, rel_widths = c(1, 0.25))
# Save image — total width = 10in, height = 6in
ggsave("Umap_imm_receptor_highlighted.png", plot = final_plot, width = 8, height = 6, dpi = 600, bg = "white")
#--------------------------------------------------------------------------------- Add UMAP plot colored by cluster with custom colors
full_metadata$cluster <- recode(full_metadata$cluster,
"NK Tgd" = "NK Tγδ",
"Tgd CD8+" = "Tγδ CD8+",
"Tgd INSIG1+" = "Tγδ INSIG1+",
"Tgd" = "Tγδ"
)
plot_data <- full_metadata %>%
filter(!is.na(cluster))
cluster_centers <- plot_data %>%
group_by(cluster) %>%
summarize(x = mean(scVI_with_hvg_UMAP_1),
y = mean(scVI_with_hvg_UMAP_2))
umap_plot <- ggplot(plot_data, aes(x = scVI_with_hvg_UMAP_1,
y = scVI_with_hvg_UMAP_2,
color = factor(cluster))) +
geom_point(size = 0.6, alpha = 0.8) +
geom_text(data = cluster_centers, aes(x = x, y = y, label = cluster),
color = "black", size = 3, hjust = 0.5, vjust = 0.5) +
labs(title = "Distributions of Cells Colored by Cluster",
x = "UMAP 1",
y = "UMAP 2",
color = "Cluster") +
theme_minimal() +
theme(legend.position = "none",
plot.title = element_text(hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "white", color = NA))
ggsave("Umap_cluster_highlighted.png", plot = umap_plot, width = 8, height = 6, dpi = 600, bg = "white")
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/2_immune receptors distribution")
#-------------------------------------------------------------------------------- Add UMAP plot colored by imm_receptor_Esmaeil with custom colors
library(ggplot2)
library(dplyr)
library(cowplot)
# Define receptor colors and labels
receptor_colors <- c(
"ab" = "#ee1819",
"gd" = "#fd7d00",
"hkl" = "#fcd919",
"Aberrant ab" = "#3a78ce",
"Aberrant g" = "#47ad45",
"None" = "#eeeeee"
)
receptor_labels <- c(
"ab" = "TCR⍺β",
"gd" = "TCRγδ",
"hkl" = "hkl",
"Aberrant ab" = "Aberrant ⍺β",
"Aberrant g" = "Aberrant γ"
)
# Set factor levels
full_metadata$imm_receptor_Esmaeil <- factor(
full_metadata$imm_receptor_Esmaeil,
levels = c("ab", "gd", "Aberrant ab", "Aberrant g", "hkl", "None")
)
# Main UMAP plot (without legend)
main_plot <- ggplot() +
geom_point(
data = full_metadata %>% filter(imm_receptor_Esmaeil != ""),
aes(x = scVI_with_hvg_UMAP_1, y = scVI_with_hvg_UMAP_2, color = imm_receptor_Esmaeil),
size = 0.2, alpha = 0.8
) +
scale_color_manual(values = receptor_colors, labels = receptor_labels) +
labs(
title = "Distributions of Cells Colored by Immune Receptor",
x = "UMAP 1",
y = "UMAP 2"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5),
legend.position = "none",
panel.grid = element_blank(),
plot.background = element_rect(fill = "white", color = NA)
)
# Separate plot for extracting legend with custom title
legend_plot <- ggplot() +
geom_point(
data = full_metadata %>% filter(imm_receptor_Esmaeil != ""),
aes(x = scVI_with_hvg_UMAP_1, y = scVI_with_hvg_UMAP_2, color = imm_receptor_Esmaeil)
) +
scale_color_manual(values = receptor_colors, labels = receptor_labels) +
labs(color = "immune receptor") +
guides(color = guide_legend(override.aes = list(size = 4))) +
theme_void()
legend <- cowplot::get_legend(legend_plot)
# Combine plot and legend side by side
final_plot <- cowplot::plot_grid(main_plot, legend, ncol = 2, rel_widths = c(1, 0.25))
ggsave("Umap_imm_receptor_highlighted.png", plot = final_plot, width = 8, height = 6, dpi = 600, bg = "white")
