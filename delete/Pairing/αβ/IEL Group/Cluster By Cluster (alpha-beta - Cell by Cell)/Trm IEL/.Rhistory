full_metadata = full_metadata[full_metadata$cluster == "CD8 Cyt.", ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter(!is.na(TRBV) & TRBV != "")
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
unique(full_metadata$TRAV)
table(full_metadata$TRAV)
full_metadata$TRAV <- factor(full_metadata$TRAV,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
table(full_metadata$TRAV)
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV)
View(trav_summary)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary_complete <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
trav_summary <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/CD8 Cyt")
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(writexl)
full_metadata = full_metadata[full_metadata$cluster == "CD8 Cyt.", ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter(!is.na(TRBV) & TRBV != "")
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
full_metadata$TRAV <- factor(full_metadata$TRAV,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
View(trav_summary)
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/Trm IEL")
library(dplyr)
full_metadata = full_metadata[full_metadata$cluster == "Trm IEL", ]
full_metadata = full_metadata[full_metadata$TRAV == "TRAV12-1" |
full_metadata$TRAV == "TRAV12-2" |
full_metadata$TRAV == "TRAV30" |
full_metadata$TRAV == "TRAV8-4" |
full_metadata$TRAV == "TRAV8-6", ]
full_metadata <- full_metadata %>% filter( !is.na(full_metadata$TRAV) & !is.na(full_metadata$TRBV) )
result <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(TRBVs = paste(unique(TRBV), collapse = ","), .groups = "drop") %>%
arrange(Diagnosis, TRAV)
View(result)
result <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(TRBVs = paste(unique(TRBV), collapse = ","), .groups = "drop") %>%
arrange(Diagnosis, TRAV)
all_sectors <- unique(c(full_metadata$TRAV, full_metadata$TRBV))
all_sectors <- na.omit(all_sectors)
# Example: define your own colors
custom_colors <- c(
"TRAV12-1"  = "#FFB6C1",
"TRAV12-2"  = "#800000",
"TRAV30"  = "#0082C8",
"TRAV8-4"  = "#FDCEAC",
"TRAV8-6"  = "#7F7F3C"
)
# Assign any sectors not listed above to grey
grid.col <- setNames(rep("grey", length(all_sectors)), all_sectors)
grid.col[names(custom_colors)] <- custom_colors
TRAV_order <- sort(unique(na.omit(full_metadata$TRAV)))
other_sectors <- setdiff(unique(c(full_metadata$TRAV, full_metadata$TRBV)), TRAV_order)
sector_order <- c(TRAV_order, other_sectors)
# chordDiagram
Diagnosiss <- unique(full_metadata$Diagnosis)
Diagnosiss <- unique(full_metadata$Diagnosis)
View(trav_summary)
View(result)
View(result)
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
diagnosis_summary <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(count = n(), .groups = "drop_last") %>%
mutate(total = sum(count),
percent = round(100 * count / total, 2)) %>%
ungroup() %>%
arrange(Diagnosis, TRAV)
View(diagnosis_summary)
result <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(TRBVs = paste(unique(TRBV), collapse = ","), .groups = "drop") %>%
arrange(Diagnosis, TRAV)
View(result)
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/CD8 Cyt")
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(writexl)
full_metadata = full_metadata[full_metadata$cluster == "CD8 Cyt.", ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter(!is.na(TRBV) & TRBV != "")
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
full_metadata$TRAV <- factor(full_metadata$TRAV,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
View(trav_summary)
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/CD8 Cyt")
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(writexl)
full_metadata = full_metadata[full_metadata$cluster == "CD8 Cyt.", ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter(!is.na(TRBV) & TRBV != "")
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
full_metadata$TRAV <- factor(full_metadata$TRAV,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
write_xlsx(trav_summary, "TRAV_summary.xlsx")
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/Cyt. IEL")
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(writexl)
full_metadata = full_metadata[full_metadata$cluster == "Cyt. IEL", ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter( !is.na(full_metadata$TRAV) & !is.na(full_metadata$TRBV) )
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV_group = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
full_metadata$TRAV_group <- factor(full_metadata$TRAV_group,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV_group) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV_group)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary_complete <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/Cyt. IEL")
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(writexl)
full_metadata = full_metadata[full_metadata$cluster == "Cyt. IEL", ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter( !is.na(full_metadata$TRAV) & !is.na(full_metadata$TRBV) )
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV_group = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
full_metadata$TRAV_group <- factor(full_metadata$TRAV_group,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV_group) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV_group)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary_complete <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
trav_summary <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/Cyt. IEL")
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(writexl)
full_metadata = full_metadata[full_metadata$cluster == "Cyt. IEL", ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter(!is.na(TRBV) & TRBV != "")
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
full_metadata$TRAV <- factor(full_metadata$TRAV,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV)
View(trav_summary)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
write_xlsx(trav_summary, "TRAV_summary.xlsx")
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/IEL CCL4+")
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(writexl)
full_metadata = full_metadata[full_metadata$cluster == "IEL CCL4+", ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter( !is.na(full_metadata$TRAV) & !is.na(full_metadata$TRBV) )
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV_group = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
full_metadata$TRAV_group <- factor(full_metadata$TRAV_group,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV_group) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV_group)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary_complete <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/IEL CCL4+")
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(writexl)
full_metadata = full_metadata[full_metadata$cluster == "IEL CCL4+", ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter(!is.na(TRBV) & TRBV != "")
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
full_metadata$TRAV <- factor(full_metadata$TRAV,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
write_xlsx(trav_summary, "TRAV_summary.xlsx")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/IEL CCL4+")
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(writexl)
full_metadata = full_metadata[full_metadata$cluster == "IEL CCL4+", ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter(!is.na(TRBV) & TRBV != "")
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
full_metadata$TRAV <- factor(full_metadata$TRAV,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
write_xlsx(trav_summary, "TRAV_summary.xlsx")
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/IEL GZMK+")
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(writexl)
full_metadata = full_metadata[full_metadata$cluster == "IEL GZMK+" , ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter( !is.na(full_metadata$TRAV) & !is.na(full_metadata$TRBV) )
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV_group = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
full_metadata$TRAV_group <- factor(full_metadata$TRAV_group,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV_group) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV_group)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary_complete <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/IEL GZMK+")
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(writexl)
full_metadata = full_metadata[full_metadata$cluster == "IEL GZMK+" , ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter(!is.na(TRBV) & TRBV != "")
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
full_metadata$TRAV <- factor(full_metadata$TRAV,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
write_xlsx(trav_summary, "TRAV_summary.xlsx")
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/nIEL")
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(writexl)
full_metadata = full_metadata[ full_metadata$cluster == "nIEL" , ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter(!is.na(TRBV) & TRBV != "")
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
full_metadata$TRAV <- factor(full_metadata$TRAV,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
write_xlsx(trav_summary, "TRAV_summary.xlsx")
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/Prolif. IEL")
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(writexl)
full_metadata = full_metadata[full_metadata$cluster == "Prolif. IEL" , ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter(!is.na(TRBV) & TRBV != "")
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
full_metadata$TRAV <- factor(full_metadata$TRAV,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
write_xlsx(trav_summary, "TRAV_summary.xlsx")
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Pairing/alph-beta/IEL Group/Cluster By Cluster (alpha-beta - Cell by Cell)/Trm IEL")
library(dplyr)
full_metadata = full_metadata[full_metadata$cluster == "Trm IEL", ]
full_metadata <- full_metadata %>% filter(!is.na(TRAV) & TRAV != "")
full_metadata <- full_metadata %>% filter(!is.na(TRBV) & TRBV != "")
target_travs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6")
full_metadata <- full_metadata %>% mutate(TRAV = ifelse(TRAV %in% target_travs, TRAV, "Other TRAVs"))
full_metadata$TRAV <- factor(full_metadata$TRAV,
levels = c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs"))
trav_summary <- full_metadata %>%
group_by(Diagnosis, TRAV) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(Diagnosis) %>%
mutate(total_cells = sum(count),
percent = round((count / total_cells) * 100, 2)) %>%
arrange(Diagnosis, TRAV)
all_TRAVs <- c("TRAV12-1", "TRAV12-2", "TRAV30", "TRAV8-4", "TRAV8-6", "Other TRAVs")
trav_summary <- trav_summary %>%
group_by(Diagnosis) %>%
# create all combinations of Diagnosis x TRAV
complete(TRAV = all_TRAVs, fill = list(count = 0, percent = 0)) %>%
# total_cells should be the same for each Diagnosis
mutate(total_cells = max(total_cells, na.rm = TRUE)) %>%
ungroup() %>%
arrange(Diagnosis, factor(TRAV, levels = all_TRAVs))
write_xlsx(trav_summary, "TRAV_summary.xlsx")
load("C:/Esmaeil/CeliacProject/BackUp/Meta Data/MetaData_Esmaeil.Rdata")
unique(full_metadata$cluster)
