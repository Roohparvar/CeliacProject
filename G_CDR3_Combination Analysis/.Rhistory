load("C:/Esmaeil/CeliacProject/BackUp/MetaData_V2_Esmaeil.Rdata")
library(dplyr)
library(writexl)
# فیلتر و شمارش بر اساس شرایط خواسته‌شده
combo_counts <- tibble(
Description = c(
"g_cdr3 present, a_cdr3, b_cdr3, d_cdr3 absent",
"g_cdr3 and a_cdr3 present, b_cdr3 and d_cdr3 absent",
"g_cdr3 and b_cdr3 present, a_cdr3 and d_cdr3 absent",
"g_cdr3, a_cdr3 and b_cdr3 present, d_cdr3 absent"
),
`Cell Count` = c(
full_metadata %>%
filter(!is.na(g_cdr3) & is.na(a_cdr3) & is.na(b_cdr3) & is.na(d_cdr3)) %>%
nrow(),
full_metadata %>%
filter(!is.na(g_cdr3) & !is.na(a_cdr3) & is.na(b_cdr3) & is.na(d_cdr3)) %>%
nrow(),
full_metadata %>%
filter(!is.na(g_cdr3) & is.na(a_cdr3) & !is.na(b_cdr3) & is.na(d_cdr3)) %>%
nrow(),
full_metadata %>%
filter(!is.na(g_cdr3) & !is.na(a_cdr3) & !is.na(b_cdr3) & is.na(d_cdr3)) %>%
nrow()
)
)
# ذخیره به فایل اکسل
write_xlsx(combo_counts, "G_CDR3_Combinations_Summary.xlsx")
library(dplyr)
library(ggplot2)
# 1. انتخاب ستون‌های مورد نیاز
umap_matrix <- full_metadata %>%
select(
scVI_with_hvg_UMAP_1, scVI_with_hvg_UMAP_2,
a_cdr3, b_cdr3, g_cdr3, d_cdr3
)
# 2. افزودن 4 ستون رنگی، پیش‌فرض gray
umap_matrix$`ColourG!ABD`    <- "gray"
umap_matrix$`ColourGA!BD`    <- "gray"
umap_matrix$`ColourGB!AD`    <- "gray"
umap_matrix$`ColourGAB!D`    <- "gray"
# 3. اعمال شرایط برای هر رنگ خاص
# شرط: فقط g دارد، بقیه ندارد
umap_matrix$`ColourG!ABD`[!is.na(umap_matrix$g_cdr3) &
is.na(umap_matrix$a_cdr3) &
is.na(umap_matrix$b_cdr3) &
is.na(umap_matrix$d_cdr3)] <- "red"
# شرط: g و a دارد، b و d ندارد
umap_matrix$`ColourGA!BD`[!is.na(umap_matrix$g_cdr3) &
!is.na(umap_matrix$a_cdr3) &
is.na(umap_matrix$b_cdr3) &
is.na(umap_matrix$d_cdr3)] <- "blue"
# شرط: g و b دارد، a و d ندارد
umap_matrix$`ColourGB!AD`[!is.na(umap_matrix$g_cdr3) &
is.na(umap_matrix$a_cdr3) &
!is.na(umap_matrix$b_cdr3) &
is.na(umap_matrix$d_cdr3)] <- "green"
# شرط: g و a و b دارد، d ندارد
umap_matrix$`ColourGAB!D`[!is.na(umap_matrix$g_cdr3) &
!is.na(umap_matrix$a_cdr3) &
!is.na(umap_matrix$b_cdr3) &
is.na(umap_matrix$d_cdr3)] <- "yellow"
View(umap_matrix)
# 4. ساخت 4 UMAP جداگانه
# UMAP - فقط g دارد
png("UMAP_ColourG_only.png", width = 2000, height = 1600, res = 300)
ggplot(umap_matrix, aes(
x = scVI_with_hvg_UMAP_1,
y = scVI_with_hvg_UMAP_2
)) +
geom_point(color = umap_matrix$`ColourG!ABD`, size = 0.2, alpha = 0.8) +
labs(title = "UMAP - G only", x = "UMAP 1", y = "UMAP 2") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 12),
axis.title = element_text(size = 10),
axis.text = element_text(size = 8)
)
dev.off()
# UMAP - G and A
png("UMAP_ColourG_and_A.png", width = 2000, height = 1600, res = 300)
ggplot(umap_matrix, aes(
x = scVI_with_hvg_UMAP_1,
y = scVI_with_hvg_UMAP_2
)) +
geom_point(color = umap_matrix$`ColourGA!BD`, size = 0.2, alpha = 0.8) +
labs(title = "UMAP - G and A", x = "UMAP 1", y = "UMAP 2") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 12),
axis.title = element_text(size = 10),
axis.text = element_text(size = 8)
)
dev.off()
# UMAP - G and B
png("UMAP_ColourG_and_B.png", width = 2000, height = 1600, res = 300)
ggplot(umap_matrix, aes(
x = scVI_with_hvg_UMAP_1,
y = scVI_with_hvg_UMAP_2
)) +
geom_point(color = umap_matrix$`ColourGB!AD`, size = 0.2, alpha = 0.8) +
labs(title = "UMAP - G and B", x = "UMAP 1", y = "UMAP 2") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 12),
axis.title = element_text(size = 10),
axis.text = element_text(size = 8)
)
dev.off()
# UMAP - G and A and B
png("UMAP_ColourG_A_B.png", width = 2000, height = 1600, res = 300)
ggplot(umap_matrix, aes(
x = scVI_with_hvg_UMAP_1,
y = scVI_with_hvg_UMAP_2
)) +
geom_point(color = umap_matrix$`ColourGAB!D`, size = 0.2, alpha = 0.8) +
labs(title = "UMAP - G, A and B", x = "UMAP 1", y = "UMAP 2") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 12),
axis.title = element_text(size = 10),
axis.text = element_text(size = 8)
)
dev.off()
library(ggplot2)
# تابع کمکی برای ساخت UMAP با legend
plot_umap_with_legend <- function(color_col_name, title_text, filename) {
# ستون رنگ ها را به عنوان فاکتور برای legend تعریف می‌کنیم
umap_matrix$ColorFactor <- factor(umap_matrix[[color_col_name]])
# رنگ‌های منحصربفرد داخل ستون
unique_colors <- unique(umap_matrix[[color_col_name]])
# فقط رنگ‌هایی که غیر از "gray" هستند رو می‌گیریم (برای legend)
legend_colors <- unique_colors[unique_colors != "gray"]
legend_labels <- switch(color_col_name,
"ColourG!ABD" = "Cells with g_cdr3 only",
"ColourGA!BD" = "Cells with g_cdr3 and a_cdr3 only",
"ColourGB!AD" = "Cells with g_cdr3 and b_cdr3 only",
"ColourGAB!D" = "Cells with g_cdr3, a_cdr3 and b_cdr3 only",
color_col_name)
# مقادیر legend به شکل نام رنگ و برچسب
names(legend_colors) <- legend_labels
png(filename, width = 2000, height = 1600, res = 300)
p <- ggplot(umap_matrix, aes(x = scVI_with_hvg_UMAP_1, y = scVI_with_hvg_UMAP_2)) +
geom_point(color = "gray80", size = 0.1, alpha = 0.6) +
geom_point(data = subset(umap_matrix, ColorFactor != "gray"),
aes(color = ColorFactor), size = 0.2, alpha = 0.9) +
scale_color_manual(name = "Cell Type", values = legend_colors) +
labs(title = title_text, x = "UMAP 1", y = "UMAP 2") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 12),
legend.title = element_text(size = 10),
legend.text = element_text(size = 9),
axis.title = element_text(size = 10),
axis.text = element_text(size = 8)
)
print(p)
dev.off()
}
# حالا 4 تا نمودار با legend درست می‌کنیم:
plot_umap_with_legend("ColourG!ABD", "UMAP - G only", "UMAP_ColourG_only.png")
plot_umap_with_legend("ColourGA!BD", "UMAP - G and A", "UMAP_ColourG_and_A.png")
plot_umap_with_legend("ColourGB!AD", "UMAP - G and B", "UMAP_ColourG_and_B.png")
plot_umap_with_legend("ColourGAB!D", "UMAP - G, A and B", "UMAP_ColourG_A_B.png")
# 4. ساخت 4 UMAP جداگانه
# UMAP - فقط g دارد
png("UMAP_ColourG_only.png", width = 2000, height = 1600, res = 300)
ggplot(umap_matrix, aes(
x = scVI_with_hvg_UMAP_1,
y = scVI_with_hvg_UMAP_2
)) +
geom_point(color = umap_matrix$`ColourG!ABD`, size = 0.2, alpha = 0.8) +
labs(title = "UMAP - G only", x = "UMAP 1", y = "UMAP 2") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 12),
axis.title = element_text(size = 10),
axis.text = element_text(size = 8)
)
dev.off()
# UMAP - G and A
png("UMAP_ColourG_and_A.png", width = 2000, height = 1600, res = 300)
ggplot(umap_matrix, aes(
x = scVI_with_hvg_UMAP_1,
y = scVI_with_hvg_UMAP_2
)) +
geom_point(color = umap_matrix$`ColourGA!BD`, size = 0.2, alpha = 0.8) +
labs(title = "UMAP - G and A", x = "UMAP 1", y = "UMAP 2") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 12),
axis.title = element_text(size = 10),
axis.text = element_text(size = 8)
)
dev.off()
# UMAP - G and B
png("UMAP_ColourG_and_B.png", width = 2000, height = 1600, res = 300)
ggplot(umap_matrix, aes(
x = scVI_with_hvg_UMAP_1,
y = scVI_with_hvg_UMAP_2
)) +
geom_point(color = umap_matrix$`ColourGB!AD`, size = 0.2, alpha = 0.8) +
labs(title = "UMAP - G and B", x = "UMAP 1", y = "UMAP 2") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 12),
axis.title = element_text(size = 10),
axis.text = element_text(size = 8)
)
dev.off()
# UMAP - G and A and B
png("UMAP_ColourG_A_B.png", width = 2000, height = 1600, res = 300)
ggplot(umap_matrix, aes(
x = scVI_with_hvg_UMAP_1,
y = scVI_with_hvg_UMAP_2
)) +
geom_point(color = umap_matrix$`ColourGAB!D`, size = 0.2, alpha = 0.8) +
labs(title = "UMAP - G, A and B", x = "UMAP 1", y = "UMAP 2") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 12),
axis.title = element_text(size = 10),
axis.text = element_text(size = 8)
)
dev.off()
png("UMAP_Co.png", width = 2000, height = 1600, res = 300)
ggplot(umap_matrix, aes(
x = scVI_with_hvg_UMAP_1,
y = scVI_with_hvg_UMAP_2
)) +
geom_point(color = umap_matrix$`ColourG!ABD`, size = 0.2, alpha = 0.8) +
labs(
title = "UMAP - G only",
x = "UMAP 1",
y = "UMAP 2",
caption = "Cells colored red have g_cdr3 present but a_cdr3, b_cdr3, d_cdr3 absent"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 12),
axis.title = element_text(size = 10),
axis.text = element_text(size = 8),
plot.caption = element_text(size = 9, hjust = 0)  # تنظیم ظاهر caption
)
dev.off()
# 4. ساخت 4 UMAP جداگانه
# UMAP - فقط g دارد
png("UMAP_ColourG_only.png", width = 2000, height = 1600, res = 300)
ggplot(umap_matrix, aes(
x = scVI_with_hvg_UMAP_1,
y = scVI_with_hvg_UMAP_2
)) +
geom_point(color = umap_matrix$`ColourG!ABD`, size = 0.2, alpha = 0.8) +
labs(title = "Colored cells have g_cdr3 present, but a_cdr3, b_cdr3, and d_cdr3 absent.", x = "UMAP 1", y = "UMAP 2") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 12),
axis.title = element_text(size = 10),
axis.text = element_text(size = 8)
)
dev.off()
# UMAP - G and A
png("UMAP_ColourG_and_A.png", width = 2000, height = 1600, res = 300)
ggplot(umap_matrix, aes(
x = scVI_with_hvg_UMAP_1,
y = scVI_with_hvg_UMAP_2
)) +
geom_point(color = umap_matrix$`ColourGA!BD`, size = 0.2, alpha = 0.8) +
labs(title = "Colored cells have g_cdr3 and a_cdr3 present, but b_cdr3 and d_cdr3 absent", x = "UMAP 1", y = "UMAP 2") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 12),
axis.title = element_text(size = 10),
axis.text = element_text(size = 8)
)
dev.off()
# UMAP - G and B
png("UMAP_ColourG_and_B.png", width = 2000, height = 1600, res = 300)
ggplot(umap_matrix, aes(
x = scVI_with_hvg_UMAP_1,
y = scVI_with_hvg_UMAP_2
)) +
geom_point(color = umap_matrix$`ColourGB!AD`, size = 0.2, alpha = 0.8) +
labs(title = "Colored cells have g_cdr3 and b_cdr3 present, but a_cdr3 and d_cdr3 absent", x = "UMAP 1", y = "UMAP 2") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 12),
axis.title = element_text(size = 10),
axis.text = element_text(size = 8)
)
dev.off()
# UMAP - G and A and B
png("UMAP_ColourG_A_B.png", width = 2000, height = 1600, res = 300)
ggplot(umap_matrix, aes(
x = scVI_with_hvg_UMAP_1,
y = scVI_with_hvg_UMAP_2
)) +
geom_point(color = umap_matrix$`ColourGAB!D`, size = 0.2, alpha = 0.8) +
labs(title = "Colored cells have g_cdr3, a_cdr3, and b_cdr3 present, but d_cdr3 absent", x = "UMAP 1", y = "UMAP 2") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 12),
axis.title = element_text(size = 10),
axis.text = element_text(size = 8)
)
dev.off()
