match_counts[6] <- match_counts[6] + 1
next
}
#7
if (safe_equal(row$TRAV, "TRAV10") && safe_equal(row$TRAJ, "TRAJ30") &&
safe_equal(row$TRBV, "TRBV6-5") && safe_equal(row$TRBJ, "TRBJ1-4") &&
is_blank(row$TRGV) && is_blank(row$TRGJ)&&
is_blank(row$TRDV) && is_blank(row$TRDJ)) {
full_metadata[i, c("color", "shape")] <- c("#b45e3d", "circle")
match_counts[7] <- match_counts[7] + 1
next
}
#8
if (is_blank(row$TRDV) && is_blank(row$TRDJ) && is_blank(row$TRAV) && is_blank(row$TRAJ) &&
is_blank(row$TRBV) && is_blank(row$TRBJ) &&
safe_equal(row$TRGV, "TRGV3") && safe_equal(row$TRGJ, "TRGJ1")) {
full_metadata[i, c("color", "shape")] <- c("#9aaf9e", "triangle")
match_counts[8] <- match_counts[8] + 1
next
}
#9
if (is_blank(row$TRDV) && is_blank(row$TRDJ) && is_blank(row$TRAV) && is_blank(row$TRAJ) &&
is_blank(row$TRBV) && is_blank(row$TRBJ) &&
safe_equal(row$TRGV, "TRGV8") && safe_equal(row$TRGJ, "TRGJP2")) {
full_metadata[i, c("color", "shape")] <- c("#ca563f", "triangle")
match_counts[9] <- match_counts[9] + 1
next
}
#10
if (is_blank(row$TRDV) && is_blank(row$TRDJ) && is_blank(row$TRAV) && is_blank(row$TRAJ) &&
is_blank(row$TRBV) && is_blank(row$TRBJ) &&
safe_equal(row$TRGV, "TRGV3") && safe_equal(row$TRGJ, "TRGJP2")) {
full_metadata[i, c("color", "shape")] <- c("#f4d3c2", "triangle")
match_counts[10] <- match_counts[10] + 1
next
}
#11
if (is_blank(row$TRDV) && is_blank(row$TRDJ) && is_blank(row$TRAV) && is_blank(row$TRAJ) &&
is_blank(row$TRBV) && is_blank(row$TRBJ) &&
safe_equal(row$TRGV, "TRGV10") && safe_equal(row$TRGJ, "TRGJ1")) {
full_metadata[i, c("color", "shape")] <- c("#e9d41f", "triangle")
match_counts[11] <- match_counts[11] + 1
next
}
# شرط 12 (پیش‌فرض)
full_metadata[i, c("color", "shape")] <- c("#c7c7c7", "circle")
match_counts[12] <- match_counts[12] + 1
}
# چاپ تعداد دفعاتی که هر شرط برقرار بوده
for (j in 1:12) {
cat(paste("شرط", j, ":", match_counts[j], "بار درست بود\n"))
}
unique(full_metadata$TRBV)
unique(full_metadata$TRBJ)
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
trav29_metadata <- full_metadata %>%
filter(!is.na(TRAV) & TRAV == "TRAV29")
unique(full_metadata$TRAV)
trav29_metadata <- full_metadata %>%
filter(!is.na(TRAV) & TRAV == "TRAV29/DV5")
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
full_metadata <- full_metadata %>%
filter(!is.na(TRAV) & TRAV == "TRAV29/DV5")
full_metadata <- full_metadata %>%
filter(!is.na(TRAJ) & TRAJ == "TRAV36")
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
unique(full_metadata$TRAJ)
full_metadata <- full_metadata %>%
filter(!is.na(TRAJ) & TRAJ == "TRAV36")
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
full_metadata <- full_metadata %>%
filter(!is.na(TRAV) & TRAV == "TRAV29/DV5")
full_metadata <- full_metadata %>%
filter(!is.na(TRAJ) & TRAJ == "TRAJ36")
full_metadata <- full_metadata %>%
filter(!is.na(TRBV) & TRBV == "TRBV27")
View(full_metadata)
full_metadata <- full_metadata %>%
filter(!is.na(TRBJ) & TRBJ == "TRBJ1-5")
View(full_metadata)
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
full_metadata <- full_metadata %>%
filter(!is.na(TRAV) & TRAV == "TRAV29/DV5")
full_metadata <- full_metadata %>%
filter(!is.na(TRAJ) & TRAJ == "TRAJ17")
full_metadata <- full_metadata %>%
filter(!is.na(TRBV) & TRBV == "TRBV27")
full_metadata <- full_metadata %>%
filter(!is.na(TRBJ) & TRBJ == "TRBJ1-5")
full_metadata <- full_metadata %>%
filter(is.na(TRGV))
full_metadata <- full_metadata %>%
filter(is.na(TRGJ))
full_metadata <- full_metadata %>%
filter(is.na(TRDV))
full_metadata <- full_metadata %>%
filter(is.na(TRDJ))
View(full_metadata)
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
full_metadata <- full_metadata %>%
filter(!is.na(TRAV) & TRAV == "TRAV29/DV5")
full_metadata <- full_metadata %>%
filter(!is.na(TRAJ) & TRAJ == "TRAJ36")
full_metadata <- full_metadata %>%
filter(!is.na(TRBV) & TRBV == "TRBV27")
full_metadata <- full_metadata %>%
filter(!is.na(TRBJ) & TRBJ == "TRBJ1-5")
full_metadata <- full_metadata %>%
filter(is.na(TRGV))
full_metadata <- full_metadata %>%
filter(is.na(TRGJ))
full_metadata <- full_metadata %>%
filter(is.na(TRDV))
full_metadata <- full_metadata %>%
filter(is.na(TRDJ))
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
full_metadata <- full_metadata %>%
filter(!is.na(TRAV) & TRAV == "TRAV25")
full_metadata <- full_metadata %>%
filter(!is.na(TRAJ) & TRAJ == "TRAJ36")
full_metadata <- full_metadata %>%
filter(!is.na(TRBV) & TRBV == "TRBV27")
full_metadata <- full_metadata %>%
filter(!is.na(TRBJ) & TRBJ == "TRBJ1-5")
full_metadata <- full_metadata %>%
filter(is.na(TRGV))
full_metadata <- full_metadata %>%
filter(is.na(TRGJ))
full_metadata <- full_metadata %>%
filter(is.na(TRDV))
full_metadata <- full_metadata %>%
filter(is.na(TRDJ))
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
full_metadata <- full_metadata %>%
filter(!is.na(TRAV) & TRAV == "TRAV29/DV5")
full_metadata <- full_metadata %>%
filter(!is.na(TRAJ) & TRAJ == "TRAJ17")
full_metadata <- full_metadata %>%
filter(!is.na(TRBV) & TRBV == "TRBV27")
full_metadata <- full_metadata %>%
filter(!is.na(TRBJ) & TRBJ == "TRBJ1-5")
full_metadata <- full_metadata %>%
filter(is.na(TRGV))
full_metadata <- full_metadata %>%
filter(is.na(TRGJ))
full_metadata <- full_metadata %>%
filter(is.na(TRDV))
full_metadata <- full_metadata %>%
filter(is.na(TRDJ))
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
full_metadata <- full_metadata %>%
filter(!is.na(TRAV) & TRAV == "TRAV1")
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
full_metadata <- full_metadata %>%
filter(!is.na(TRAV) & TRAV == "TRAV1-1")
full_metadata <- full_metadata %>%
filter(!is.na(TRAJ) & TRAJ == "TRAJ4")
full_metadata <- full_metadata %>%
filter(!is.na(TRBV) & TRBV == "TRBV29-1")
full_metadata <- full_metadata %>%
filter(!is.na(TRBJ) & TRBJ == "TRBJ1-2")
full_metadata <- full_metadata %>%
filter(is.na(TRGV))
full_metadata <- full_metadata %>%
filter(is.na(TRGJ))
full_metadata <- full_metadata %>%
filter(is.na(TRDV))
full_metadata <- full_metadata %>%
filter(is.na(TRDJ))
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
full_metadata <- full_metadata %>%
filter(!is.na(TRAV) & TRAV == "TRAV29/DV5")
full_metadata <- full_metadata %>%
filter(!is.na(TRAJ) & TRAJ == "TRAJ49")
full_metadata <- full_metadata %>%
filter(!is.na(TRBV) & TRBV == "TRBV7-9")
full_metadata <- full_metadata %>%
filter(!is.na(TRBJ) & TRBJ == "TRBJ2-1")
full_metadata <- full_metadata %>%
filter(is.na(TRGV))
full_metadata <- full_metadata %>%
filter(is.na(TRGJ))
full_metadata <- full_metadata %>%
filter(is.na(TRDV))
full_metadata <- full_metadata %>%
filter(is.na(TRDJ))
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
full_metadata <- full_metadata %>%
filter(!is.na(TRAV) & TRAV == "TRAV8")
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
unique(full_metadata$TRAV)
full_metadata <- full_metadata %>%
filter(!is.na(TRAJ) & TRAJ == "TRAJ27")
full_metadata <- full_metadata %>%
filter(!is.na(TRBV) & TRBV == "TRBV19")
full_metadata <- full_metadata %>%
filter(!is.na(TRBJ) & TRBJ == "TRBJ2-8")
unique(full_metadata$TRBJ)
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
unique(full_metadata$TRBJ)
setwd("C:/Esmaeil")
# لیست کلاسترهایی که باید حذف شوند
target_clusters <- c(
"Plasma cells_1", "B cells_1", "B cells_2",
"B cells MZB1+", "Plasma cells_2", "Plasmablast",
"B cells BAFFR", "DC", "Macrophages", "Mast cells"
)
# حذف کلاسترهای ذکر شده
filtered_cluster_summary <- cluster_summary %>%
filter(!(cluster %in% target_clusters))
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
# لیست کلاسترهایی که باید حذف شوند
target_clusters <- c(
"Plasma cells_1", "B cells_1", "B cells_2",
"B cells MZB1+", "Plasma cells_2", "Plasmablast",
"B cells BAFFR", "DC", "Macrophages", "Mast cells"
)
# حذف کلاسترهای ذکر شده
filtered_cluster_summary <- cluster_summary %>%
filter(!(cluster %in% target_clusters))
cluster_summary <- full_metadata %>%
group_by(cluster) %>%
summarise(
Aberrant_ab = sum(imm_receptor_Esmaeil_clean == "Aberrant ab", na.rm = TRUE),
Aberrant_g = sum(imm_receptor_Esmaeil_clean == "Aberrant g", na.rm = TRUE)
) %>%
mutate(
Aberrant_total = Aberrant_ab + Aberrant_g
)
library(dplyr)
library(ggplot2)
library(tidyr)
# تعریف لیست کلاسترهایی که باید فیلتر شوند
target_clusters <- c(
"Plasma cells_1", "B cells_1", "B cells_2",
"B cells MZB1+", "Plasma cells_2", "Plasmablast",
"B cells BAFFR", "DC", "Macrophages", "Mast cells"
)
# ----------------------------------------------------------------------------- Part 2 & 3: Summary
cluster_summary <- full_metadata %>%
filter(!(cluster %in% target_clusters)) %>%  # فیلتر کردن کلاسترهای نامطلوب
group_by(cluster) %>%
summarise(
Aberrant_ab = sum(imm_receptor_Esmaeil_clean == "Aberrant ab", na.rm = TRUE),
Aberrant_g = sum(imm_receptor_Esmaeil_clean == "Aberrant g", na.rm = TRUE)
) %>%
mutate(
Aberrant_total = Aberrant_ab + Aberrant_g
)
colnames(full_metadata)
library(dplyr)
library(ggplot2)
library(tidyr)
# تعریف لیست کلاسترهایی که باید فیلتر شوند
target_clusters <- c(
"Plasma cells_1", "B cells_1", "B cells_2",
"B cells MZB1+", "Plasma cells_2", "Plasmablast",
"B cells BAFFR", "DC", "Macrophages", "Mast cells"
)
# ----------------------------------------------------------------------------- Part 2 & 3: Summary
library(dplyr)
cluster_summary <- full_metadata %>%
group_by(cluster) %>%
summarise(
Aberrant_ab = sum(imm_receptor_Esmaeil == "Aberrant ab", na.rm = TRUE),
Aberrant_g = sum(imm_receptor_Esmaeil == "Aberrant g", na.rm = TRUE)
) %>%
mutate(
Aberrant_total = Aberrant_ab + Aberrant_g
)
# ----------------------------------------------------------------------------- Part 2: Total Aberrant per Cluster
png("Cluster_Aberrant_Total_Barplot.png", width = 2000, height = 1400, res = 300)
ggplot(cluster_summary, aes(x = cluster, y = Aberrant_total)) +
geom_bar(stat = "identity", fill = "purple", width = 0.6) +
labs(
title = "Total Aberrant Cells per Cluster",
x = "Cluster",
y = "Total Aberrant Cell Count"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 7),
axis.text.y = element_text(size = 7),
plot.title = element_text(hjust = 0.5, size = 12),
axis.title.x = element_text(size = 9),
axis.title.y = element_text(size = 9)
)
dev.off()
# ----------------------------------------------------------------------------- Part 3: Split Aberrant_ab and Aberrant_g
cluster_long <- cluster_summary %>%
pivot_longer(
cols = c(Aberrant_ab, Aberrant_g),
names_to = "Type",
values_to = "Count"
)
png("Cluster_Aberrant_Split_Barplot.png", width = 2500, height = 1600, res = 300)
ggplot(cluster_long, aes(x = cluster, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.6) +
scale_fill_manual(
values = c("Aberrant_ab" = "red", "Aberrant_g" = "blue"),
name = "Aberrant Cell Type",
labels = c("Aberrant ab", "Aberrant g")
) +
labs(
title = "Aberrant Cell Counts per Cluster",
x = "Cluster",
y = "Cell Count"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 7),
axis.text.y = element_text(size = 7),
plot.title = element_text(hjust = 0.5, size = 12),
legend.title = element_text(size = 10),
legend.text = element_text(size = 9)
)
dev.off()
library(dplyr)
library(ggplot2)
library(tidyr)
# لیست کلاسترهایی که می‌خواهیم حذف کنیم
target_clusters <- c(
"Plasma cells_1", "B cells_1", "B cells_2",
"B cells MZB1+", "Plasma cells_2", "Plasmablast",
"B cells BAFFR", "DC", "Macrophages", "Mast cells"
)
# خلاصه‌سازی تعداد سلول‌های aberrant
cluster_summary <- full_metadata %>%
group_by(cluster) %>%
summarise(
Aberrant_ab = sum(imm_receptor_Esmaeil == "Aberrant ab", na.rm = TRUE),
Aberrant_g = sum(imm_receptor_Esmaeil == "Aberrant g", na.rm = TRUE)
) %>%
mutate(Aberrant_total = Aberrant_ab + Aberrant_g) %>%
filter(!cluster %in% target_clusters)  # حذف کلاسترهای خاص
# --------- Part 2: Total Aberrant per cluster ---------
png("Cluster_Aberrant_Total_Barplot.png", width = 2000, height = 1400, res = 300)
ggplot(cluster_summary, aes(x = cluster, y = Aberrant_total)) +
geom_bar(stat = "identity", fill = "purple", width = 0.6) +
labs(
title = "Total Aberrant Cells per Cluster",
x = "Cluster",
y = "Total Aberrant Cell Count"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 7),
axis.text.y = element_text(size = 7),
plot.title = element_text(hjust = 0.5, size = 12),
axis.title.x = element_text(size = 9),
axis.title.y = element_text(size = 9)
)
dev.off()
# --------- Part 3: Aberrant ab vs g ---------
# تبدیل به فرمت long
cluster_long <- cluster_summary %>%
pivot_longer(
cols = c(Aberrant_ab, Aberrant_g),
names_to = "Type",
values_to = "Count"
)
png("Cluster_Aberrant_Split_Barplot.png", width = 2500, height = 1600, res = 300)
ggplot(cluster_long, aes(x = cluster, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.6) +
scale_fill_manual(
values = c("Aberrant_ab" = "red", "Aberrant_g" = "blue"),
name = "Aberrant Cell Type",
labels = c("Aberrant ab", "Aberrant g")
) +
labs(
title = "Aberrant Cell Counts per Cluster",
x = "Cluster",
y = "Cell Count"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 7),
axis.text.y = element_text(size = 7),
plot.title = element_text(hjust = 0.5, size = 12),
legend.title = element_text(size = 10),
legend.text = element_text(size = 9)
)
dev.off()
View(full_metadata)
unique(full_metadata$imm_receptor_Esmaeil)
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
library(dplyr)
library(ggplot2)
full_metadata <- full_metadata %>%
filter(imm_receptor_Esmaeil %in% c("Aberrant ab", "Aberrant g"))
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Clone Size Analysis/Top 10 Clone Sizes/2")
top10_clones <- full_metadata %>%
group_by(cdr_Full_ab) %>%
summarise(clone_size = unique(clone_size_ab)[1]) %>%
arrange(desc(clone_size)) %>%
slice_head(n = 10)
top10_clones$cdr_Full_ab <- factor(top10_clones$cdr_Full_ab,
levels = top10_clones$cdr_Full_ab)
png("Top 10 Clone Sizes.png", width = 3000, height = 2000, res = 300)
ggplot(top10_clones, aes(x = cdr_Full_ab, y = clone_size)) +
geom_bar(stat = "identity", fill = "#2c7fb8") +
labs(title = "Top 10 Clones by Clone Size", x = "Clone", y = "Clone Size") +
theme_minimal(base_size = 16) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 5),
axis.text.y = element_text(size = 5),
plot.title = element_text(hjust = 0.5, size = 20, face = "bold")
)
dev.off()
library(dplyr)
library(ggplot2)
full_metadata <- full_metadata %>%
filter(imm_receptor_Esmaeil %in% c("Aberrant ab", "Aberrant g"))
top10_clones <- full_metadata %>%
group_by(cdr_Full_ab) %>%
summarise(clone_size = unique(clone_size_ab)[1]) %>%
arrange(desc(clone_size)) %>%
slice_head(n = 10)
top10_clones$cdr_Full_ab <- factor(top10_clones$cdr_Full_ab,
levels = top10_clones$cdr_Full_ab)
png("Top 10 Clone Sizes.png", width = 3000, height = 2000, res = 300)
ggplot(top10_clones, aes(x = cdr_Full_ab, y = clone_size)) +
geom_bar(stat = "identity", fill = "#2c7fb8") +
labs(title = "Top 10 Aberrant Clones by Clone Size", x = "Clone", y = "Clone Size") +
theme_minimal(base_size = 16) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 5),
axis.text.y = element_text(size = 5),
plot.title = element_text(hjust = 0.5, size = 20, face = "bold")
)
dev.off()
print(top10_clones)
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
library(dplyr)
library(ggplot2)
#full_metadata <- full_metadata %>%
#filter(imm_receptor_Esmaeil %in% c("Aberrant ab", "Aberrant g"))
top10_clones <- full_metadata %>%
group_by(cdr_Full_ab) %>%
summarise(clone_size = unique(clone_size_ab)[1]) %>%
arrange(desc(clone_size)) %>%
slice_head(n = 10)
top10_clones$cdr_Full_ab <- factor(top10_clones$cdr_Full_ab,
levels = top10_clones$cdr_Full_ab)
png("Top 10 Clone Sizes.png", width = 3000, height = 2000, res = 300)
ggplot(top10_clones, aes(x = cdr_Full_ab, y = clone_size)) +
geom_bar(stat = "identity", fill = "#2c7fb8") +
labs(title = "Top 10 Clones by Clone Size", x = "Clone", y = "Clone Size") +
theme_minimal(base_size = 16) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 5),
axis.text.y = element_text(size = 5),
plot.title = element_text(hjust = 0.5, size = 20, face = "bold")
)
dev.off()
print(top10_clones)
setwd("C:/Esmaeil/CeliacProject/CeliacProject/Clone Size Analysis/Unique Clones Per Clusters")
library(dplyr)
library(ggplot2)
clone_per_cluster <- full_metadata %>%
group_by(cluster) %>%
summarise(unique_clones = n_distinct(cdr_Full_ab)) %>%
ungroup() %>%
arrange(desc(unique_clones)) %>%
mutate(cluster = factor(cluster, levels = cluster))
load("C:/Esmaeil/CeliacProject/BackUp/MetaData/MetaData_Esmaeil.Rdata")
library(dplyr)
library(ggplot2)
clone_per_cluster <- full_metadata %>%
group_by(cluster) %>%
summarise(unique_clones = n_distinct(cdr_Full_ab)) %>%
ungroup() %>%
arrange(desc(unique_clones)) %>%
mutate(cluster = factor(cluster, levels = cluster))
png("Unique Clones Per Clusters.png", width = 2800, height = 2000, res = 300)
ggplot(clone_per_cluster, aes(x = cluster, y = unique_clones)) +
geom_bar(stat = "identity", fill = "#2171b5") +
labs(
title = "Number of Unique Clones per Cluster",
x = "Cluster",
y = "Unique Clones"
) +
theme_minimal(base_size = 16) +
theme(
plot.title = element_text(hjust = 0.5, size = 20),
axis.text.y = element_text(size = 7),
axis.text.x = element_text(angle = 45, hjust = 1, size = 7)
)
dev.off()
library(dplyr)
library(ggplot2)
clone_per_cluster <- full_metadata %>%
group_by(cluster) %>%
summarise(unique_clones = n_distinct(cdr_Full_ab)) %>%
ungroup() %>%
arrange(desc(unique_clones)) %>%
mutate(cluster = factor(cluster, levels = cluster))
png("Unique ab Clones Per Clusters.png", width = 2800, height = 2000, res = 300)
ggplot(clone_per_cluster, aes(x = cluster, y = unique_clones)) +
geom_bar(stat = "identity", fill = "#2171b5") +
labs(
title = "Number of Unique ab Clones per Cluster",
x = "Cluster",
y = "Unique Clones"
) +
theme_minimal(base_size = 16) +
theme(
plot.title = element_text(hjust = 0.5, size = 20),
axis.text.y = element_text(size = 7),
axis.text.x = element_text(angle = 45, hjust = 1, size = 7)
)
dev.off()
